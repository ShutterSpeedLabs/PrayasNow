package com.example.prayasnow.repository

import com.example.prayasnow.data.AppDatabase
import com.example.prayasnow.data.Quiz
import com.example.prayasnow.data.SyncMetadata
import com.google.firebase.firestore.FirebaseFirestore
import com.google.firebase.firestore.Query
import kotlinx.coroutines.Dispatchers
import kotlinx.coroutines.tasks.await
import kotlinx.coroutines.withContext

class QuizRepository(
    private val firestore: FirebaseFirestore,
    val database: AppDatabase
) {
    companion object {
        private const val QUIZ_COLLECTION = "quizzes"
        private const val LAST_SYNC_KEY = "quiz_last_sync"
        private const val SYNC_VERSION_KEY = "quiz_sync_version"
    }

    // Fetch quizzes from Firebase with incremental sync
    suspend fun syncQuizzesFromFirebase(userId: String): List<Quiz> = withContext(Dispatchers.IO) {
        try {
            val lastSyncTimestamp = getLastSyncTimestamp()
            println("üîÑ Starting quiz sync. Last sync: $lastSyncTimestamp")
            
            // Query Firebase for quizzes updated after last sync
            val query = if (lastSyncTimestamp > 0) {
                firestore.collection(QUIZ_COLLECTION)
                    .whereGreaterThan("lastUpdated", lastSyncTimestamp)
                    .orderBy("lastUpdated", Query.Direction.ASCENDING)
            } else {
                // First sync - get all quizzes
                firestore.collection(QUIZ_COLLECTION)
                    .orderBy("lastUpdated", Query.Direction.ASCENDING)
            }
            
            val snapshot = query.get().await()
            val syncedQuizzes = mutableListOf<Quiz>()
            var latestTimestamp = lastSyncTimestamp
            
            for (doc in snapshot.documents) {
                try {
                    val firebaseQuiz = mapFirebaseDocumentToQuiz(doc.data ?: continue, doc.id, userId)
                    
                    // Check if quiz exists locally
                    val existingQuiz = database.quizDao().getQuizByFirebaseId(doc.id)
                    
                    if (existingQuiz != null) {
                        // Update existing quiz if Firebase version is newer
                        if (firebaseQuiz.version > existingQuiz.version) {
                            val updatedQuiz = firebaseQuiz.copy(
                                id = existingQuiz.id, // Keep local ID
                                attempted = existingQuiz.attempted // Preserve local state
                            )
                            database.quizDao().updateQuiz(updatedQuiz)
                            syncedQuizzes.add(updatedQuiz)
                            println("üìù Updated quiz: ${firebaseQuiz.question.take(50)}...")
                        }
                    } else {
                        // Insert new quiz
                        database.quizDao().insertQuiz(firebaseQuiz)
                        syncedQuizzes.add(firebaseQuiz)
                        println("‚ûï Added new quiz: ${firebaseQuiz.question.take(50)}...")
                    }
                    
                    // Track latest timestamp
                    if (firebaseQuiz.lastUpdated > latestTimestamp) {
                        latestTimestamp = firebaseQuiz.lastUpdated
                    }
                    
                } catch (e: Exception) {
                    println("‚ùå Error processing quiz document ${doc.id}: ${e.message}")
                }
            }
            
            // Update last sync timestamp
            if (latestTimestamp > lastSyncTimestamp) {
                updateLastSyncTimestamp(latestTimestamp)
            }
            
            println("‚úÖ Quiz sync completed. Synced ${syncedQuizzes.size} quizzes")
            syncedQuizzes
            
        } catch (e: Exception) {
            println("‚ùå Error syncing quizzes from Firebase: ${e.message}")
            emptyList()
        }
    }
    
    // Map Firebase document to Quiz entity
    private fun mapFirebaseDocumentToQuiz(data: Map<String, Any>, firebaseId: String, userId: String): Quiz {
        return Quiz(
            id = 0, // Room will auto-generate
            firebaseId = firebaseId,
            userId = userId,
            title = data["title"] as? String ?: "",
            subject = data["subject"] as? String ?: "Science",
            question = data["question"] as? String ?: "",
            options = (data["options"] as? List<*>)?.map { it.toString() } ?: emptyList(),
            answer = data["answer"] as? String ?: "",
            explanation = data["explanation"] as? String ?: "",
            attempted = false, // Local state
            timestamp = System.currentTimeMillis(),
            version = (data["version"] as? Long) ?: 1L,
            lastUpdated = (data["lastUpdated"] as? Long) ?: System.currentTimeMillis(),
            syncStatus = "SYNCED"
        )
    }
    
    // Get last sync timestamp
    private suspend fun getLastSyncTimestamp(): Long {
        return try {
            val metadata = database.syncMetadataDao().getMetadata(LAST_SYNC_KEY)
            metadata?.value?.toLongOrNull() ?: 0L
        } catch (e: Exception) {
            println("‚ùå Error getting last sync timestamp: ${e.message}")
            0L
        }
    }
    
    // Update last sync timestamp
    private suspend fun updateLastSyncTimestamp(timestamp: Long) {
        try {
            val metadata = SyncMetadata(
                key = LAST_SYNC_KEY,
                value = timestamp.toString(),
                timestamp = System.currentTimeMillis()
            )
            database.syncMetadataDao().insertMetadata(metadata)
            println("üìÖ Updated last sync timestamp: $timestamp")
        } catch (e: Exception) {
            println("‚ùå Error updating last sync timestamp: ${e.message}")
        }
    }
    
    // Get quizzes by subject from local database (after sync)
    suspend fun getQuizzesBySubject(userId: String, subject: String): List<Quiz> = withContext(Dispatchers.IO) {
        try {
            database.quizDao().getQuizzesBySubject(userId, subject)
        } catch (e: Exception) {
            println("‚ùå Error getting quizzes by subject: ${e.message}")
            emptyList()
        }
    }
    
    // Get quizzes by title and subject
    suspend fun getQuizzesByTitle(userId: String, subject: String, title: String): List<Quiz> = withContext(Dispatchers.IO) {
        try {
            database.quizDao().getQuizzesBySubject(userId, subject).filter { it.title == title }
        } catch (e: Exception) {
            println("‚ùå Error getting quizzes by title: ${e.message}")
            emptyList()
        }
    }
    
    // Force sync quizzes from Firebase
    suspend fun forceSync(userId: String): Boolean = withContext(Dispatchers.IO) {
        try {
            // Reset last sync timestamp to force full sync
            database.syncMetadataDao().deleteMetadataByKey(LAST_SYNC_KEY)
            val syncedQuizzes = syncQuizzesFromFirebase(userId)
            syncedQuizzes.isNotEmpty()
        } catch (e: Exception) {
            println("‚ùå Error during force sync: ${e.message}")
            false
        }
    }
    
    // Check if sync is needed (based on time interval)
    suspend fun isSyncNeeded(intervalHours: Int = 24): Boolean = withContext(Dispatchers.IO) {
        try {
            val lastSync = getLastSyncTimestamp()
            val currentTime = System.currentTimeMillis()
            val intervalMillis = intervalHours * 60 * 60 * 1000L
            
            (currentTime - lastSync) > intervalMillis
        } catch (e: Exception) {
            println("‚ùå Error checking sync status: ${e.message}")
            true // Default to sync needed if error
        }
    }
    
    // Get available subjects from local database
    suspend fun getAvailableSubjects(userId: String): List<String> = withContext(Dispatchers.IO) {
        try {
            database.quizDao().getAvailableSubjects(userId)
        } catch (e: Exception) {
            println("‚ùå Error getting available subjects: ${e.message}")
            listOf("Science", "History", "Geography", "Maths") // Fallback
        }
    }
    
    // Get quiz titles for a subject
    suspend fun getQuizTitlesForSubject(userId: String, subject: String): List<String> = withContext(Dispatchers.IO) {
        try {
            val quizzes = database.quizDao().getQuizzesBySubject(userId, subject)
            quizzes.map { it.title }.distinct()
        } catch (e: Exception) {
            println("‚ùå Error getting quiz titles: ${e.message}")
            emptyList()
        }
    }

    // Legacy method for backward compatibility - now triggers sync
    suspend fun insertSampleQuizzes(userId: String) = withContext(Dispatchers.IO) {
        try {
            println("üîÑ insertSampleQuizzes called - triggering Firebase sync instead")
            syncQuizzesFromFirebase(userId)
        } catch (e: Exception) {
            println("‚ùå Error in insertSampleQuizzes: ${e.message}")
            // Fallback to static data if Firebase fails
            insertFallbackQuizzes(userId)
        }
    }
    
    // Fallback static quizzes (only used if Firebase sync fails)
    private suspend fun insertFallbackQuizzes(userId: String) = withContext(Dispatchers.IO) {
        val allQuizzes = mutableListOf<Quiz>()
        
        // Add Science Quizzes (100 questions)
        allQuizzes.addAll(getScienceQuizzes(userId))
        
        // Add History Quizzes (100 questions)
        allQuizzes.addAll(getHistoryQuizzes(userId))
        
        // Add Geography Quizzes (100 questions)
        allQuizzes.addAll(getGeographyQuizzes(userId))
        
        // Add Maths Quizzes (100 questions)
        allQuizzes.addAll(getMathsQuizzes(userId))
        
        allQuizzes.forEach { database.quizDao().insertQuiz(it) }
    }
    
    // Create multiple quizzes for Science (10 questions each)
    fun getScienceQuizzes(userId: String): List<Quiz> {
        return listOf(
            // Quiz 1: Physics Basics
            Quiz(
                userId = userId,
                title = "Physics Basics",
                subject = "Science",
                question = "What is the SI unit of force?",
                options = listOf("Newton", "Joule", "Watt", "Pascal"),
                answer = "Newton",
                explanation = "Newton (N) is the SI unit of force, named after Sir Isaac Newton. It's defined as the force needed to accelerate 1 kg of mass at 1 m/s¬≤."
            ),
            Quiz(
                userId = userId,
                title = "Physics Basics",
                subject = "Science",
                question = "Which of the following is a vector quantity?",
                options = listOf("Mass", "Temperature", "Velocity", "Time"),
                answer = "Velocity",
                explanation = "Velocity is a vector quantity because it has both magnitude (speed) and direction. Mass, temperature, and time are scalar quantities with only magnitude."
            ),
            Quiz(
                userId = userId,
                title = "Physics Basics",
                subject = "Science",
                question = "What is the formula for kinetic energy?",
                options = listOf("KE = mgh", "KE = ¬Ωmv¬≤", "KE = mv", "KE = ¬Ωmgh"),
                answer = "KE = ¬Ωmv¬≤",
                explanation = "Kinetic energy is the energy of motion. The formula KE = ¬Ωmv¬≤ shows that it depends on mass (m) and the square of velocity (v¬≤)."
            ),
            Quiz(
                userId = userId,
                title = "Physics Basics",
                subject = "Science",
                question = "Which law states that every action has an equal and opposite reaction?",
                options = listOf("Newton's First Law", "Newton's Second Law", "Newton's Third Law", "Law of Gravitation"),
                answer = "Newton's Third Law",
                explanation = "Newton's Third Law states that for every action, there is an equal and opposite reaction. When you push on a wall, the wall pushes back with equal force."
            ),
            Quiz(
                userId = userId,
                title = "Physics Basics",
                subject = "Science",
                question = "What is the unit of electric current?",
                options = listOf("Volt", "Ampere", "Ohm", "Watt"),
                answer = "Ampere",
                explanation = "Ampere (A) is the SI unit of electric current, measuring the flow of electric charge. It's named after Andr√©-Marie Amp√®re, a French physicist."
            ),
            Quiz(
                userId = userId,
                title = "Physics Basics",
                subject = "Science",
                question = "Which wave can travel through vacuum?",
                options = listOf("Sound waves", "Light waves", "Water waves", "Seismic waves"),
                answer = "Light waves"
            ),
            Quiz(
                userId = userId,
                title = "Physics Basics",
                subject = "Science",
                question = "What is the speed of light in vacuum?",
                options = listOf("3 √ó 10‚Å∏ m/s", "3 √ó 10‚Åµ m/s", "3 √ó 10¬π‚Å∞ m/s", "3 √ó 10‚Å∂ m/s"),
                answer = "3 √ó 10‚Å∏ m/s"
            ),
            Quiz(
                userId = userId,
                title = "Physics Basics",
                subject = "Science",
                question = "Which device converts mechanical energy to electrical energy?",
                options = listOf("Motor", "Generator", "Battery", "Resistor"),
                answer = "Generator"
            ),
            Quiz(
                userId = userId,
                title = "Physics Basics",
                subject = "Science",
                question = "What is the principle of conservation of energy?",
                options = listOf("Energy can be created", "Energy can be destroyed", "Energy cannot be created or destroyed", "Energy can be converted to matter"),
                answer = "Energy cannot be created or destroyed"
            ),
            Quiz(
                userId = userId,
                title = "Physics Basics",
                subject = "Science",
                question = "Which force is responsible for keeping planets in orbit?",
                options = listOf("Magnetic force", "Gravitational force", "Nuclear force", "Frictional force"),
                answer = "Gravitational force"
            ),
            
            // Quiz 2: Chemistry Fundamentals
            Quiz(
                userId = userId,
                title = "Chemistry Fundamentals",
                subject = "Science",
                question = "What is the chemical symbol for gold?",
                options = listOf("Ag", "Au", "Fe", "Cu"),
                answer = "Au"
            ),
            Quiz(
                userId = userId,
                title = "Chemistry Fundamentals",
                subject = "Science",
                question = "Which gas is called the silent killer?",
                options = listOf("Carbon dioxide", "Carbon monoxide", "Nitrogen", "Oxygen"),
                answer = "Carbon monoxide"
            ),
            Quiz(
                userId = userId,
                title = "Chemistry Fundamentals",
                subject = "Science",
                question = "What is the pH of a neutral solution?",
                options = listOf("0", "7", "14", "10"),
                answer = "7"
            ),
            Quiz(
                userId = userId,
                title = "Chemistry Fundamentals",
                subject = "Science",
                question = "Which element has the atomic number 1?",
                options = listOf("Helium", "Hydrogen", "Lithium", "Carbon"),
                answer = "Hydrogen"
            ),
            Quiz(
                userId = userId,
                title = "Chemistry Fundamentals",
                subject = "Science",
                question = "What type of bond is formed by sharing electrons?",
                options = listOf("Ionic bond", "Covalent bond", "Metallic bond", "Hydrogen bond"),
                answer = "Covalent bond"
            ),
            Quiz(
                userId = userId,
                title = "Chemistry Fundamentals",
                subject = "Science",
                question = "Which gas is essential for photosynthesis?",
                options = listOf("Oxygen", "Carbon dioxide", "Nitrogen", "Hydrogen"),
                answer = "Carbon dioxide"
            ),
            Quiz(
                userId = userId,
                title = "Chemistry Fundamentals",
                subject = "Science",
                question = "What is the chemical formula for water?",
                options = listOf("H2O", "CO2", "O2", "N2"),
                answer = "H2O"
            ),
            Quiz(
                userId = userId,
                title = "Chemistry Fundamentals",
                subject = "Science",
                question = "Which metal is most reactive?",
                options = listOf("Iron", "Copper", "Sodium", "Gold"),
                answer = "Sodium"
            ),
            Quiz(
                userId = userId,
                title = "Chemistry Fundamentals",
                subject = "Science",
                question = "What is the process of rusting called?",
                options = listOf("Oxidation", "Reduction", "Neutralization", "Hydrolysis"),
                answer = "Oxidation"
            ),
            Quiz(
                userId = userId,
                title = "Chemistry Fundamentals",
                subject = "Science",
                question = "Which gas is called the greenhouse gas?",
                options = listOf("Oxygen", "Carbon dioxide", "Nitrogen", "Hydrogen"),
                answer = "Carbon dioxide"
            ),
            
            // Quiz 3: Biology Basics
            Quiz(
                userId = userId,
                title = "Biology Basics",
                subject = "Science",
                question = "What is the powerhouse of the cell?",
                options = listOf("Nucleus", "Mitochondria", "Ribosome", "Golgi apparatus"),
                answer = "Mitochondria"
            ),
            Quiz(
                userId = userId,
                title = "Biology Basics",
                subject = "Science",
                question = "Which organ pumps blood throughout the body?",
                options = listOf("Lungs", "Heart", "Liver", "Kidney"),
                answer = "Heart"
            ),
            Quiz(
                userId = userId,
                title = "Biology Basics",
                subject = "Science",
                question = "What is the process by which plants make food?",
                options = listOf("Respiration", "Photosynthesis", "Digestion", "Excretion"),
                answer = "Photosynthesis"
            ),
            Quiz(
                userId = userId,
                title = "Biology Basics",
                subject = "Science",
                question = "Which system protects the body from diseases?",
                options = listOf("Digestive system", "Immune system", "Nervous system", "Respiratory system"),
                answer = "Immune system"
            ),
            Quiz(
                userId = userId,
                title = "Biology Basics",
                subject = "Science",
                question = "What is the largest organ in the human body?",
                options = listOf("Heart", "Brain", "Skin", "Liver"),
                answer = "Skin"
            ),
            Quiz(
                userId = userId,
                title = "Biology Basics",
                subject = "Science",
                question = "Which gas do plants release during photosynthesis?",
                options = listOf("Carbon dioxide", "Oxygen", "Nitrogen", "Hydrogen"),
                answer = "Oxygen"
            ),
            Quiz(
                userId = userId,
                title = "Biology Basics",
                subject = "Science",
                question = "What is the study of heredity called?",
                options = listOf("Ecology", "Genetics", "Taxonomy", "Physiology"),
                answer = "Genetics"
            ),
            Quiz(
                userId = userId,
                title = "Biology Basics",
                subject = "Science",
                question = "Which blood group is called the universal donor?",
                options = listOf("A", "B", "AB", "O"),
                answer = "O"
            ),
            Quiz(
                userId = userId,
                title = "Biology Basics",
                subject = "Science",
                question = "What is the main function of red blood cells?",
                options = listOf("Fight infection", "Transport oxygen", "Clot blood", "Produce antibodies"),
                answer = "Transport oxygen"
            ),
            Quiz(
                userId = userId,
                title = "Biology Basics",
                subject = "Science",
                question = "Which vitamin is produced by the skin in sunlight?",
                options = listOf("Vitamin A", "Vitamin B", "Vitamin C", "Vitamin D"),
                answer = "Vitamin D"
            )
        )
    }
    
    // Create multiple quizzes for History (10 questions each)
    fun getHistoryQuizzes(userId: String): List<Quiz> {
        return listOf(
            // Quiz 1: Ancient India
            Quiz(
                userId = userId,
                title = "Ancient India",
                subject = "History",
                question = "Which was the first major civilization in India?",
                options = listOf("Mauryan Empire", "Indus Valley", "Gupta Empire", "Mughal Empire"),
                answer = "Indus Valley"
            ),
            Quiz(
                userId = userId,
                title = "Ancient India",
                subject = "History",
                question = "Who was the founder of the Mauryan Empire?",
                options = listOf("Ashoka", "Chandragupta Maurya", "Bindusara", "Samprati"),
                answer = "Chandragupta Maurya"
            ),
            Quiz(
                userId = userId,
                title = "Ancient India",
                subject = "History",
                question = "Which emperor embraced Buddhism after the Kalinga war?",
                options = listOf("Chandragupta", "Ashoka", "Bindusara", "Samprati"),
                answer = "Ashoka"
            ),
            Quiz(
                userId = userId,
                title = "Ancient India",
                subject = "History",
                question = "What was the capital of the Gupta Empire?",
                options = listOf("Pataliputra", "Ujjain", "Taxila", "Sarnath"),
                answer = "Pataliputra"
            ),
            Quiz(
                userId = userId,
                title = "Ancient India",
                subject = "History",
                question = "Who wrote the Arthashastra?",
                options = listOf("Kautilya", "Panini", "Kalidasa", "Aryabhata"),
                answer = "Kautilya"
            ),
            Quiz(
                userId = userId,
                title = "Ancient India",
                subject = "History",
                question = "Which dynasty ruled during the Golden Age of India?",
                options = listOf("Mauryan", "Gupta", "Mughal", "Chola"),
                answer = "Gupta"
            ),
            Quiz(
                userId = userId,
                title = "Ancient India",
                subject = "History",
                question = "What was the main religion during the Gupta period?",
                options = listOf("Buddhism", "Jainism", "Hinduism", "Islam"),
                answer = "Hinduism"
            ),
            Quiz(
                userId = userId,
                title = "Ancient India",
                subject = "History",
                question = "Which ancient university was a center of learning?",
                options = listOf("Nalanda", "Taxila", "Vikramshila", "All of the above"),
                answer = "All of the above"
            ),
            Quiz(
                userId = userId,
                title = "Ancient India",
                subject = "History",
                question = "Who was the first emperor to unify most of India?",
                options = listOf("Ashoka", "Chandragupta Maurya", "Samudragupta", "Harsha"),
                answer = "Chandragupta Maurya"
            ),
            Quiz(
                userId = userId,
                title = "Ancient India",
                subject = "History",
                question = "Which script was used in Ashoka's inscriptions?",
                options = listOf("Brahmi", "Devanagari", "Kharosthi", "Tamil"),
                answer = "Brahmi"
            ),
            
            // Quiz 2: Medieval India
            Quiz(
                userId = userId,
                title = "Medieval India",
                subject = "History",
                question = "Who was the first Muslim ruler of Delhi?",
                options = listOf("Qutb-ud-din Aibak", "Iltutmish", "Razia Sultan", "Balban"),
                answer = "Qutb-ud-din Aibak"
            ),
            Quiz(
                userId = userId,
                title = "Medieval India",
                subject = "History",
                question = "Which dynasty built the Qutub Minar?",
                options = listOf("Slave Dynasty", "Khilji Dynasty", "Tughlaq Dynasty", "Lodhi Dynasty"),
                answer = "Slave Dynasty"
            ),
            Quiz(
                userId = userId,
                title = "Medieval India",
                subject = "History",
                question = "Who was the only woman to rule Delhi Sultanate?",
                options = listOf("Razia Sultan", "Nur Jahan", "Mumtaz Mahal", "Jahanara"),
                answer = "Razia Sultan"
            ),
            Quiz(
                userId = userId,
                title = "Medieval India",
                subject = "History",
                question = "Which Mughal emperor built the Taj Mahal?",
                options = listOf("Akbar", "Jahangir", "Shah Jahan", "Aurangzeb"),
                answer = "Shah Jahan"
            ),
            Quiz(
                userId = userId,
                title = "Medieval India",
                subject = "History",
                question = "Who was the founder of the Mughal Empire?",
                options = listOf("Babur", "Humayun", "Akbar", "Jahangir"),
                answer = "Babur"
            ),
            Quiz(
                userId = userId,
                title = "Medieval India",
                subject = "History",
                question = "Which battle marked the beginning of British rule in India?",
                options = listOf("Battle of Plassey", "Battle of Buxar", "Battle of Panipat", "Battle of Haldighati"),
                answer = "Battle of Plassey"
            ),
            Quiz(
                userId = userId,
                title = "Medieval India",
                subject = "History",
                question = "Who was the greatest ruler of the Mughal Empire?",
                options = listOf("Babur", "Akbar", "Shah Jahan", "Aurangzeb"),
                answer = "Akbar"
            ),
            Quiz(
                userId = userId,
                title = "Medieval India",
                subject = "History",
                question = "Which empire was known as the 'Golden Bird'?",
                options = listOf("Gupta Empire", "Mughal Empire", "Maratha Empire", "Chola Empire"),
                answer = "Mughal Empire"
            ),
            Quiz(
                userId = userId,
                title = "Medieval India",
                subject = "History",
                question = "Who was the last Mughal emperor?",
                options = listOf("Shah Alam II", "Bahadur Shah Zafar", "Akbar II", "Jahangir"),
                answer = "Bahadur Shah Zafar"
            ),
            Quiz(
                userId = userId,
                title = "Medieval India",
                subject = "History",
                question = "Which Sikh guru was martyred by Aurangzeb?",
                options = listOf("Guru Nanak", "Guru Tegh Bahadur", "Guru Gobind Singh", "Guru Arjan"),
                answer = "Guru Tegh Bahadur"
            ),
            
            // Quiz 3: Modern India
            Quiz(
                userId = userId,
                title = "Modern India",
                subject = "History",
                question = "Who was the first Governor-General of India?",
                options = listOf("Warren Hastings", "Lord Cornwallis", "Lord Wellesley", "Lord Dalhousie"),
                answer = "Warren Hastings"
            ),
            Quiz(
                userId = userId,
                title = "Modern India",
                subject = "History",
                question = "When did the First War of Independence occur?",
                options = listOf("1857", "1858", "1859", "1860"),
                answer = "1857"
            ),
            Quiz(
                userId = userId,
                title = "Modern India",
                subject = "History",
                question = "Who founded the Indian National Congress?",
                options = listOf("A.O. Hume", "Dadabhai Naoroji", "W.C. Bonnerjee", "All of the above"),
                answer = "All of the above"
            ),
            Quiz(
                userId = userId,
                title = "Modern India",
                subject = "History",
                question = "Who was called the 'Father of the Nation'?",
                options = listOf("Jawaharlal Nehru", "Mahatma Gandhi", "Subhas Chandra Bose", "Sardar Patel"),
                answer = "Mahatma Gandhi"
            ),
            Quiz(
                userId = userId,
                title = "Modern India",
                subject = "History",
                question = "When did India gain independence?",
                options = listOf("1945", "1946", "1947", "1948"),
                answer = "1947"
            ),
            Quiz(
                userId = userId,
                title = "Modern India",
                subject = "History",
                question = "Who was the first Prime Minister of India?",
                options = listOf("Sardar Patel", "Jawaharlal Nehru", "Rajendra Prasad", "Subhas Chandra Bose"),
                answer = "Jawaharlal Nehru"
            ),
            Quiz(
                userId = userId,
                title = "Modern India",
                subject = "History",
                question = "Which movement was started by Mahatma Gandhi in 1930?",
                options = listOf("Non-Cooperation", "Civil Disobedience", "Quit India", "Salt March"),
                answer = "Salt March"
            ),
            Quiz(
                userId = userId,
                title = "Modern India",
                subject = "History",
                question = "Who was the first President of India?",
                options = listOf("Rajendra Prasad", "S. Radhakrishnan", "Zakir Husain", "V.V. Giri"),
                answer = "Rajendra Prasad"
            ),
            Quiz(
                userId = userId,
                title = "Modern India",
                subject = "History",
                question = "When was the Indian Constitution adopted?",
                options = listOf("1949", "1950", "1951", "1952"),
                answer = "1950"
            ),
            Quiz(
                userId = userId,
                title = "Modern India",
                subject = "History",
                question = "Who was known as 'Netaji'?",
                options = listOf("Mahatma Gandhi", "Subhas Chandra Bose", "Bhagat Singh", "Chandrashekhar Azad"),
                answer = "Subhas Chandra Bose"
            )
        )
    }
    
    // Create multiple quizzes for Geography (10 questions each)
    fun getGeographyQuizzes(userId: String): List<Quiz> {
        return listOf(
            // Quiz 1: Physical Geography
            Quiz(userId = userId, title = "Physical Geography", subject = "Geography", 
                question = "Which is the highest peak in India?", 
                options = listOf("K2", "Kanchenjunga", "Nanda Devi", "Mount Everest"), answer = "Kanchenjunga"),
            Quiz(userId = userId, title = "Physical Geography", subject = "Geography", 
                question = "Which river is known as the 'Sorrow of Bengal'?", 
                options = listOf("Ganga", "Brahmaputra", "Damodar", "Hooghly"), answer = "Damodar"),
            Quiz(userId = userId, title = "Physical Geography", subject = "Geography", 
                question = "Which is the largest desert in India?", 
                options = listOf("Thar", "Rann of Kutch", "Ladakh", "Deccan"), answer = "Thar"),
            Quiz(userId = userId, title = "Physical Geography", subject = "Geography", 
                question = "Which mountain range is known as the 'Roof of the World'?", 
                options = listOf("Himalayas", "Karakoram", "Pamir", "Tibetan Plateau"), answer = "Pamir"),
            Quiz(userId = userId, title = "Physical Geography", subject = "Geography", 
                question = "Which is the longest river in India?", 
                options = listOf("Ganga", "Brahmaputra", "Yamuna", "Godavari"), answer = "Ganga"),
            Quiz(userId = userId, title = "Physical Geography", subject = "Geography", 
                question = "Which plateau is known as the 'Deccan Trap'?", 
                options = listOf("Malwa", "Chota Nagpur", "Deccan", "Bundelkhand"), answer = "Deccan"),
            Quiz(userId = userId, title = "Physical Geography", subject = "Geography", 
                question = "Which is the largest lake in India?", 
                options = listOf("Dal Lake", "Wular Lake", "Chilika Lake", "Vembanad Lake"), answer = "Wular Lake"),
            Quiz(userId = userId, title = "Physical Geography", subject = "Geography", 
                question = "Which state has the longest coastline?", 
                options = listOf("Gujarat", "Maharashtra", "Tamil Nadu", "Kerala"), answer = "Gujarat"),
            Quiz(userId = userId, title = "Physical Geography", subject = "Geography", 
                question = "Which is the largest delta in the world?", 
                options = listOf("Ganga-Brahmaputra", "Nile", "Amazon", "Mississippi"), answer = "Ganga-Brahmaputra"),
            Quiz(userId = userId, title = "Physical Geography", subject = "Geography", 
                question = "Which is the highest waterfall in India?", 
                options = listOf("Jog Falls", "Dudhsagar", "Athirappilly", "Hogenakal"), answer = "Jog Falls"),
            
            // Quiz 2: Climate and Weather
            Quiz(userId = userId, title = "Climate and Weather", subject = "Geography", 
                question = "Which monsoon brings rainfall to most of India?", 
                options = listOf("Southwest", "Northeast", "Northwest", "Southeast"), answer = "Southwest"),
            Quiz(userId = userId, title = "Climate and Weather", subject = "Geography", 
                question = "Which city is known as the 'Cherrapunji of South India'?", 
                options = listOf("Munnar", "Ooty", "Agumbe", "Coorg"), answer = "Agumbe"),
            Quiz(userId = userId, title = "Climate and Weather", subject = "Geography", 
                question = "Which type of climate does India have?", 
                options = listOf("Tropical", "Temperate", "Monsoon", "Desert"), answer = "Monsoon"),
            Quiz(userId = userId, title = "Climate and Weather", subject = "Geography", 
                question = "Which is the driest place in India?", 
                options = listOf("Jaisalmer", "Leh", "Jodhpur", "Bikaner"), answer = "Leh"),
            Quiz(userId = userId, title = "Climate and Weather", subject = "Geography", 
                question = "Which wind causes winter rainfall in Tamil Nadu?", 
                options = listOf("Southwest Monsoon", "Northeast Monsoon", "Trade Winds", "Westerlies"), answer = "Northeast Monsoon"),
            Quiz(userId = userId, title = "Climate and Weather", subject = "Geography", 
                question = "Which is the wettest place in India?", 
                options = listOf("Mawsynram", "Cherrapunji", "Agumbe", "Silchar"), answer = "Mawsynram"),
            Quiz(userId = userId, title = "Climate and Weather", subject = "Geography", 
                question = "Which season is known as the 'Season of Retreating Monsoon'?", 
                options = listOf("Winter", "Summer", "Autumn", "Spring"), answer = "Autumn"),
            Quiz(userId = userId, title = "Climate and Weather", subject = "Geography", 
                question = "Which city has the highest temperature in India?", 
                options = listOf("Delhi", "Ahmedabad", "Jodhpur", "Phalodi"), answer = "Phalodi"),
            Quiz(userId = userId, title = "Climate and Weather", subject = "Geography", 
                question = "Which is the coldest place in India?", 
                options = listOf("Leh", "Srinagar", "Shimla", "Dras"), answer = "Dras"),
            Quiz(userId = userId, title = "Climate and Weather", subject = "Geography", 
                question = "Which wind brings winter rainfall to North India?", 
                options = listOf("Western Disturbances", "Northeast Monsoon", "Trade Winds", "Polar Winds"), answer = "Western Disturbances"),
            
            // Quiz 3: Economic Geography
            Quiz(userId = userId, title = "Economic Geography", subject = "Geography", 
                question = "Which state is the largest producer of rice?", 
                options = listOf("Punjab", "Haryana", "West Bengal", "Uttar Pradesh"), answer = "West Bengal"),
            Quiz(userId = userId, title = "Economic Geography", subject = "Geography", 
                question = "Which state is the largest producer of wheat?", 
                options = listOf("Punjab", "Haryana", "Uttar Pradesh", "Madhya Pradesh"), answer = "Uttar Pradesh"),
            Quiz(userId = userId, title = "Economic Geography", subject = "Geography", 
                question = "Which is the largest producer of cotton?", 
                options = listOf("Maharashtra", "Gujarat", "Madhya Pradesh", "Karnataka"), answer = "Gujarat"),
            Quiz(userId = userId, title = "Economic Geography", subject = "Geography", 
                question = "Which state is the largest producer of sugarcane?", 
                options = listOf("Maharashtra", "Uttar Pradesh", "Karnataka", "Tamil Nadu"), answer = "Uttar Pradesh"),
            Quiz(userId = userId, title = "Economic Geography", subject = "Geography", 
                question = "Which is the largest producer of tea?", 
                options = listOf("Assam", "West Bengal", "Tamil Nadu", "Kerala"), answer = "Assam"),
            Quiz(userId = userId, title = "Economic Geography", subject = "Geography", 
                question = "Which state is the largest producer of coffee?", 
                options = listOf("Karnataka", "Kerala", "Tamil Nadu", "Andhra Pradesh"), answer = "Karnataka"),
            Quiz(userId = userId, title = "Economic Geography", subject = "Geography", 
                question = "Which is the largest producer of jute?", 
                options = listOf("West Bengal", "Bihar", "Assam", "Odisha"), answer = "West Bengal"),
            Quiz(userId = userId, title = "Economic Geography", subject = "Geography", 
                question = "Which state is the largest producer of spices?", 
                options = listOf("Kerala", "Karnataka", "Tamil Nadu", "Andhra Pradesh"), answer = "Kerala"),
            Quiz(userId = userId, title = "Economic Geography", subject = "Geography", 
                question = "Which is the largest producer of rubber?", 
                options = listOf("Kerala", "Tamil Nadu", "Karnataka", "Andhra Pradesh"), answer = "Kerala"),
            Quiz(userId = userId, title = "Economic Geography", subject = "Geography", 
                question = "Which state is the largest producer of mangoes?", 
                options = listOf("Maharashtra", "Uttar Pradesh", "Andhra Pradesh", "Karnataka"), answer = "Uttar Pradesh")
        )
    }
    
    // Create multiple quizzes for Maths (10 questions each)
    fun getMathsQuizzes(userId: String): List<Quiz> {
        return listOf(
            // Quiz 1: Algebra
            Quiz(userId = userId, title = "Algebra", subject = "Maths", 
                question = "What is the value of x if 2x + 5 = 13?", 
                options = listOf("3", "4", "5", "6"), answer = "4"),
            Quiz(userId = userId, title = "Algebra", subject = "Maths", 
                question = "What is the square of 12?", 
                options = listOf("144", "124", "134", "154"), answer = "144"),
            Quiz(userId = userId, title = "Algebra", subject = "Maths", 
                question = "What is the cube root of 27?", 
                options = listOf("3", "9", "27", "81"), answer = "3"),
            Quiz(userId = userId, title = "Algebra", subject = "Maths", 
                question = "What is the value of (a + b)¬≤?", 
                options = listOf("a¬≤ + b¬≤", "a¬≤ + 2ab + b¬≤", "a¬≤ - 2ab + b¬≤", "2a + 2b"), answer = "a¬≤ + 2ab + b¬≤"),
            Quiz(userId = userId, title = "Algebra", subject = "Maths", 
                question = "What is the HCF of 24 and 36?", 
                options = listOf("6", "12", "24", "36"), answer = "12"),
            Quiz(userId = userId, title = "Algebra", subject = "Maths", 
                question = "What is the LCM of 8 and 12?", 
                options = listOf("24", "48", "96", "12"), answer = "24"),
            Quiz(userId = userId, title = "Algebra", subject = "Maths", 
                question = "What is the value of x if 3x - 7 = 8?", 
                options = listOf("3", "5", "7", "9"), answer = "5"),
            Quiz(userId = userId, title = "Algebra", subject = "Maths", 
                question = "What is the square root of 100?", 
                options = listOf("5", "10", "50", "100"), answer = "10"),
            Quiz(userId = userId, title = "Algebra", subject = "Maths", 
                question = "What is the value of 2¬≥ √ó 3¬≤?", 
                options = listOf("72", "36", "108", "144"), answer = "72"),
            Quiz(userId = userId, title = "Algebra", subject = "Maths", 
                question = "What is the value of (x + y)(x - y)?", 
                options = listOf("x¬≤ - y¬≤", "x¬≤ + y¬≤", "2xy", "x¬≤ + 2xy + y¬≤"), answer = "x¬≤ - y¬≤"),
            
            // Quiz 2: Geometry
            Quiz(userId = userId, title = "Geometry", subject = "Maths", 
                question = "What is the area of a circle with radius 7 cm?", 
                options = listOf("44 cm¬≤", "154 cm¬≤", "308 cm¬≤", "616 cm¬≤"), answer = "154 cm¬≤"),
            Quiz(userId = userId, title = "Geometry", subject = "Maths", 
                question = "What is the perimeter of a square with side 5 cm?", 
                options = listOf("10 cm", "15 cm", "20 cm", "25 cm"), answer = "20 cm"),
            Quiz(userId = userId, title = "Geometry", subject = "Maths", 
                question = "What is the area of a rectangle with length 8 cm and breadth 6 cm?", 
                options = listOf("14 cm¬≤", "28 cm¬≤", "48 cm¬≤", "56 cm¬≤"), answer = "48 cm¬≤"),
            Quiz(userId = userId, title = "Geometry", subject = "Maths", 
                question = "What is the volume of a cube with side 3 cm?", 
                options = listOf("9 cm¬≥", "18 cm¬≥", "27 cm¬≥", "36 cm¬≥"), answer = "27 cm¬≥"),
            Quiz(userId = userId, title = "Geometry", subject = "Maths", 
                question = "What is the sum of angles in a triangle?", 
                options = listOf("90¬∞", "180¬∞", "270¬∞", "360¬∞"), answer = "180¬∞"),
            Quiz(userId = userId, title = "Geometry", subject = "Maths", 
                question = "What is the area of a triangle with base 6 cm and height 4 cm?", 
                options = listOf("12 cm¬≤", "24 cm¬≤", "36 cm¬≤", "48 cm¬≤"), answer = "12 cm¬≤"),
            Quiz(userId = userId, title = "Geometry", subject = "Maths", 
                question = "What is the circumference of a circle with diameter 14 cm?", 
                options = listOf("22 cm", "44 cm", "88 cm", "154 cm"), answer = "44 cm"),
            Quiz(userId = userId, title = "Geometry", subject = "Maths", 
                question = "What is the volume of a cylinder with radius 5 cm and height 10 cm?", 
                options = listOf("250œÄ cm¬≥", "500œÄ cm¬≥", "750œÄ cm¬≥", "1000œÄ cm¬≥"), answer = "250œÄ cm¬≥"),
            Quiz(userId = userId, title = "Geometry", subject = "Maths", 
                question = "What is the surface area of a cube with side 4 cm?", 
                options = listOf("64 cm¬≤", "96 cm¬≤", "128 cm¬≤", "256 cm¬≤"), answer = "96 cm¬≤"),
            Quiz(userId = userId, title = "Geometry", subject = "Maths", 
                question = "What is the area of a parallelogram with base 8 cm and height 5 cm?", 
                options = listOf("13 cm¬≤", "26 cm¬≤", "40 cm¬≤", "80 cm¬≤"), answer = "40 cm¬≤"),
            
            // Quiz 3: Arithmetic
            Quiz(userId = userId, title = "Arithmetic", subject = "Maths", 
                question = "What is 25% of 80?", 
                options = listOf("15", "20", "25", "30"), answer = "20"),
            Quiz(userId = userId, title = "Arithmetic", subject = "Maths", 
                question = "What is the simple interest on ‚Çπ1000 at 5% for 2 years?", 
                options = listOf("‚Çπ50", "‚Çπ100", "‚Çπ150", "‚Çπ200"), answer = "‚Çπ100"),
            Quiz(userId = userId, title = "Arithmetic", subject = "Maths", 
                question = "What is the average of 15, 20, 25, 30?", 
                options = listOf("20", "22.5", "25", "27.5"), answer = "22.5"),
            Quiz(userId = userId, title = "Arithmetic", subject = "Maths", 
                question = "What is 3/4 as a percentage?", 
                options = listOf("25%", "50%", "75%", "100%"), answer = "75%"),
            Quiz(userId = userId, title = "Arithmetic", subject = "Maths", 
                question = "What is the value of 2.5 √ó 0.4?", 
                options = listOf("0.1", "1", "10", "100"), answer = "1"),
            Quiz(userId = userId, title = "Arithmetic", subject = "Maths", 
                question = "What is the ratio of 15 to 25?", 
                options = listOf("3:5", "5:3", "15:25", "25:15"), answer = "3:5"),
            Quiz(userId = userId, title = "Arithmetic", subject = "Maths", 
                question = "What is 1/2 + 1/3?", 
                options = listOf("2/5", "3/5", "5/6", "6/5"), answer = "5/6"),
            Quiz(userId = userId, title = "Arithmetic", subject = "Maths", 
                question = "What is the speed if distance is 60 km and time is 2 hours?", 
                options = listOf("30 km/h", "60 km/h", "90 km/h", "120 km/h"), answer = "30 km/h"),
            Quiz(userId = userId, title = "Arithmetic", subject = "Maths", 
                question = "What is the profit if CP is ‚Çπ100 and SP is ‚Çπ120?", 
                options = listOf("‚Çπ10", "‚Çπ20", "‚Çπ30", "‚Çπ40"), answer = "‚Çπ20"),
            Quiz(userId = userId, title = "Arithmetic", subject = "Maths", 
                question = "What is the value of 0.5 √ó 0.5?", 
                options = listOf("0.1", "0.25", "0.5", "1"), answer = "0.25")
        )
    }

    suspend fun getAllQuizzesForUser(userId: String): List<Quiz> =
        database.quizDao().getAllQuizzesForUser(userId)

    suspend fun getAttemptedQuizCount(userId: String): Int =
        database.quizDao().getAttemptedQuizCount(userId)
    
    suspend fun getAttemptedQuizCountBySubject(userId: String, subject: String): Int =
        database.quizDao().getAttemptedQuizCountBySubject(userId, subject)

    suspend fun getTotalQuizCount(userId: String): Int =
        database.quizDao().getTotalQuizCount(userId)
    
    suspend fun getTotalQuizCountBySubject(userId: String, subject: String): Int =
        database.quizDao().getTotalQuizCountBySubject(userId, subject)
} 